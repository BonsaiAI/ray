# This template includes the steps of the rlib test job J-to-Z with TF 2 in travix.yml

steps:
- bash: |
    echo Running install phase of the original travis.yml

    # Set some variables to make the system looks like Travis
    source $BUILD_SOURCESDIRECTORY/ci/azure_pipelines/templates/travis-legacy/pre-install.sh

    # Start Original script

    # install part
    eval `python $TRAVIS_BUILD_DIR/ci/travis/determine_tests_to_run.py`
    if [ $RAY_CI_RLLIB_FULL_AFFECTED != "1" ]; then exit; fi
    ./ci/travis/install-bazel.sh
    ./ci/travis/install-dependencies.sh
    export PATH="$HOME/miniconda/bin:$PATH"
    # Originally with ./ci/suppress_output
    ./ci/travis/install-ray.sh
    # script part
    if [ $RAY_CI_RLLIB_FULL_AFFECTED != "1" ]; then exit; fi
    # Originally with ./ci/keep_alive
    bazel test --build_tests_only --test_tag_filters=tests_dir_J,tests_dir_K,tests_dir_L,tests_dir_M,tests_dir_N,tests_dir_O,tests_dir_P,tests_dir_Q,tests_dir_R,tests_dir_S,tests_dir_T,tests_dir_U,tests_dir_V,tests_dir_W,tests_dir_X,tests_dir_Y,tests_dir_Z --spawn_strategy=local --flaky_test_attempts=3 --nocache_test_results --test_verbose_timeout_warnings --progress_report_interval=100 --show_progress_rate_limit=100 --show_timestamps --test_output=errors rllib/...

    # End Original script

    exit 0
  env:
    PYTHONWARNINGS: 'ignore'
    TRAVIS: 'true'
    RLLIB_TESTING: 1
    RLLIB_TESTS_DIR_TESTS_J_TO_Z: 1
    TF_VERSION: 2.0.0b1
    TFP_VERSION: 0.8
    TORCH_VERSION: 1.4
  displayName: 'Run original rlib test job J-to-Z with TF 2'
  timeoutInMinutes: 120
