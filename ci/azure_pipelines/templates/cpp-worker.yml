# This template includes the steps of the CPP worker job in travix.yml

steps:
  - bash: |
      echo Running install phase of the original travis.yml
  
      # Set some variables to make the system looks like Travis
      source $BUILD_SOURCESDIRECTORY/ci/azure_pipelines/templates/travis-legacy/pre-install.sh
  
      # Start Original script
  
      # install part
      eval `python $TRAVIS_BUILD_DIR/ci/travis/determine_tests_to_run.py`
      ./ci/travis/install-bazel.sh
      # Originally with ./ci/suppress_output
      ./ci/travis/install-dependencies.sh
      export PATH="$HOME/miniconda/bin:$PATH"
      # Originally with ./ci/suppress_output
      ./ci/travis/install-ray.sh
      
      # script part
      bazel test //cpp:all --build_tests_only --spawn_strategy=local --flaky_test_attempts=3 --nocache_test_results --test_verbose_timeout_warnings --progress_report_interval=100 --show_progress_rate_limit=100 --show_timestamps --test_output=streamed
  
      # End Original script
  
      exit 0
    env:
      PYTHONWARNINGS: 'ignore'
      TRAVIS: 'true'
      TESTSUITE: cpp_worker
    displayName: 'Run original CPP Worker job'
    timeoutInMinutes: 120
  